input {
  file {
    path => "/logs/*.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => "json"
  }
  
  tcp {
    port => 5044
    codec => "json"
  }
}

filter {
  # Parse trading logs
  if [source] == "lyra-trading" {
    grok {
      match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:message}" }
    }
    
    # Extract trade information
    if [message] =~ /TRADE/ {
      grok {
        match => { "message" => "TRADE: %{WORD:action} %{NUMBER:amount} %{WORD:symbol} @ %{NUMBER:price}" }
      }
    }
  }
  
  # Add geolocation for IP addresses
  if [ip] {
    geoip {
      source => "ip"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "halvo-ai-%{+YYYY.MM.dd}"
  }
  
  # Output critical errors to stdout
  if [level] == "ERROR" or [level] == "CRITICAL" {
    stdout {
      codec => rubydebug
    }
  }
}
